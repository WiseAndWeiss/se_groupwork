<view class="card" bindtap="onExpand">
  <!-- 原有Card结构完全保留 -->
  <view class="header">
    <text class="title {{isExpanded ? 'expanded' : ''}}">{{title}}</text>
    <view class="icon-group">
      <view class="star-container {{is_favorited ? 'favorited' : ''}} {{animateStar ? 'animate' : ''}}">
        <image class="icon icon-star" src="{{is_favorited ? '/assets/icons/star-filled.svg' : '/assets/icons/star.svg'}}" catchtap="onFavourite" mode="widthFix" />
      </view>
    </view>
  </view>

  <view class="bottom-row">
    <view class="tags">
      <text class="tag" wx:for="{{tags}}" wx:key="*this">#{{item}}</text>
    </view>
    <view class="footer">
      <text class="author">{{name}}</text>
      <text class="time">{{time}}</text>
    </view>
  </view>

  <view class="floating-window {{isExpanded ? 'expanded' : 'collapsed'}} {{isAnimating ? 'animating' : ''}}">
    <view class="key-info {{isExpanded ? 'visible' : ''}}">关键词：{{formattedKeyInfo}}</view>
    <view class="desc">{{desc}}</view>
    <!-- 原文链接 + 添加待办按钮 -->
    <view class="link-group">
      <view class="original-link" catchtap="openWebView" data-url="{{url}}">原文链接</view>
      <view class="add-todo-btn" catchtap="handleAddTodo">添加待办</view>
    </view>
  </view>
</view>

<!-- 原有收藏相关弹窗保留 -->
<view class="fav-tip-popup" wx:if="{{showFavTipPopup}}">
  <view class="tip-content">
    <text class="tip-text">添加到默认收藏夹</text>
    <button class="modify-btn" bindtap="openCollectionSelect">修改收藏夹</button>
  </view>
</view>

<view class="collection-select-popup" wx:if="{{showCollectionSelect}}">
  <view class="select-mask" bindtap="closeAllPopups"></view>
  <view class="select-content">
    <view class="select-title">选择收藏夹</view>
    <scroll-view class="collection-scroll" scroll-y="true" enable-back-to-top="{{false}}">
      <view class="collection-list">
        <text class="collection-item {{defaultCollection && item.id === defaultCollection.id ? 'active' : ''}}" wx:for="{{collectionList}}" wx:key="id" bindtap="moveFavouriteToCollection" data-collectionid="{{item.id}}">{{item.name}}<text wx:if="{{item.is_default}}" class="default-tag">默认</text>
        </text>
      </view>
    </scroll-view>
  </view>
</view>

<!-- 待办弹窗（修复所有事件绑定 + 样式兼容） -->
<view class="modal-mask" wx:if="{{showAddTodoModal}}" bindtap="closeAddTodoModal"></view>
<view class="modal-container" wx:if="{{showAddTodoModal}}" catchtap="stopPropagation">
  <view class="modal-content">
    <!-- 标题输入 -->
    <view class="modal-item">
      <text class="modal-label">标题：</text>
      <input class="modal-input" value="{{newTodoData.title}}" bindinput="inputTodoData" data-type="title" placeholder="请输入待办标题" placeholder-class="placeholder-style" />
    </view>

    <!-- 内容输入 -->
    <view class="modal-item">
      <text class="modal-label">内容：</text>
      <textarea class="modal-input desc-input" value="{{newTodoData.content}}" bindinput="inputTodoData" data-type="content" placeholder="请输入待办内容（选填）" placeholder-class="content-placeholder-style" auto-height maxlength="-1" />
    </view>

    <!-- 开始时间选择 -->
    <view class="modal-item">
      <text class="modal-label">开始时间：</text>
      <picker mode="multiSelector" range="{{timeRange}}" value="{{newTodoStartTimeIndex}}" bindcolumnchange="handleTimeColumnChange" bindchange="confirmTime" data-type="start">
        <view class="modal-input {{!newTodoData.startTime ? 'placeholder-style' : ''}}">
          {{newTodoData.startTime || '请选择开始时间'}}
        </view>
      </picker>
    </view>

    <!-- 结束时间选择 -->
    <view class="modal-item">
      <text class="modal-label">结束时间：</text>
      <picker mode="multiSelector" range="{{timeRange}}" value="{{newTodoEndTimeIndex}}" bindcolumnchange="handleTimeColumnChange" bindchange="confirmTime" data-type="end">
        <view class="modal-input {{!newTodoData.endTime ? 'placeholder-style' : ''}}">
          {{newTodoData.endTime || '请选择结束时间'}}
        </view>
      </picker>
    </view>

    <!-- 操作按钮组 -->
    <view class="modal-btn-group">
      <view class="modal-btn cancel-btn" bindtap="closeAddTodoModal">取消</view>
      <view class="modal-btn confirm-btn" bindtap="handleAddTodoConfirm">确定</view>
    </view>
  </view>
</view>