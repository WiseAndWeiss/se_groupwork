<loading showLoading="{{showLoadingAnimation}}" />
<!-- 自定义导航栏 -->
<view class="custom-navbar">
  <!-- 返回上一页按钮 -->
  <image class="return-icon" bindtap="goBack" src="/assets/icons/return.svg"></image>
  <view class="navbar-title">浏览历史</view>
</view>

<!-- 历史记录容器 -->
<view class="history-container">
  <!-- 空状态：无浏览历史时显示 -->
  <view wx:if="{{historyList.length === 0}}" class="empty-history">
    <image src="/assets/icons/history-empty.svg" class="empty-icon" mode="widthFix"></image>
    <text class="empty-text">暂无浏览历史</text>
    <text class="empty-tip">展开文章后会在这里显示</text>
  </view>

  <!-- 历史记录列表：复用 card 组件，添加滑动删除 -->
  <view wx:else class="history-list">
    <scroll-view class="card-scroll" scroll-y="true">
      <block wx:for="{{historyList}}" wx:key="id" wx:for-index="index">
        <view class="swipe-item">
          <!-- 滑动操作按钮 -->
          <view class="swipe-actions">
            <!-- <view class="swipe-btn-container">
              <view class="icon-circle cancel-circle" bindtap="onCancelSwipe" data-index="{{index}}">
                <image class="swipe-icon" src="/assets/icons/close.svg" mode="aspectFit"></image>
              </view>
            </view> -->
            <view class="swipe-btn-container">
              <view class="icon-circle delete-circle" bindtap="deleteHistory" data-id="{{item.id}}" data-index="{{index}}">
                <image class="swipe-icon" src="/assets/icons/bin.svg" mode="aspectFit"></image>
              </view>
            </view>
          </view>
          
          <!-- 可滑动的内容区域 -->
          <view 
            class="swipe-content {{item.swipeClass || ''}}"
            bindtouchstart="onTouchStart"
            bindtouchmove="onTouchMove" 
            bindtouchend="onTouchEnd"
            data-index="{{index}}"
          >
            <!-- 复用 card 组件展示历史记录 -->
            <card-component
              class="card-component-{{index}}" 
              id_="{{item.article.id}}"
              title="{{item.article.title}}"
              time="{{item.article.publish_time}}"
              tags="{{item.article.tags}}"
              desc="{{item.article.summary}}"
              url="{{item.article.article_url}}"
              avatar="{{item.article.avatar}}"   
              key_info="{{item.article.key_info}}"
              name="{{item.article.account_name}}"   
              is_favorited="{{item.article.is_favorited}}"  
              data-isExpanded="{{true}}"
              bind:ready="initCardExpand"
              bind:collectionOperationStart="onCollectionOperationStart"
              bind:collectionOperationEnd="onCollectionOperationEnd"
            />
          </view>
        </view>
      </block>
    </scroll-view>
  </view>
  <!-- 删除全部按钮 -->
  <view class="delete-all-btn {{isCollectionOperating ? 'hidden' : ''}}" bindtap="deleteAllHistory">
    <text class="delete-btn-text">删除全部</text>
  </view>
</view>